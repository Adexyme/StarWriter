{"version":3,"file":"HtmlHandler.js","sourceRoot":"","sources":["../../src/HtmlHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { UtilityCls } from \"./UtilityCls\";\r\nimport { ElementInserter } from \"./ElementInserter\";\r\nimport { MdParser } from \"./MdParser\";\r\nimport { marked } from \"marked\";\r\nimport { Remarkable } from \"remarkable\";\r\nimport { UndoRedojs } from \"./UndoRedo\";\r\nimport { AddEvtListener } from \"./AddEvtListener\";\r\nimport { History } from \"stateshot\";\r\nimport { jsPDF } from \"jspdf\";\r\n\r\nexport class HtmlHandler {\r\n  constructor(\r\n    private histry = { history: \"\" },\r\n    //private markdownParser: MdParser = new MdParser(),\r\n    private rmkbl = new Remarkable(),\r\n    //private mkd = marked,\r\n    //private unrejs = new UndoRedojs(0),\r\n    private unreHistory = new History(),\r\n    private doc = new jsPDF(),\r\n    private eInserter: ElementInserter = new ElementInserter(),\r\n    private markdown = <HTMLTextAreaElement>(\r\n      document.getElementById(UtilityCls.inputElement)\r\n    ),\r\n    private markdownOutput = <HTMLLabelElement>(\r\n      document.getElementById(UtilityCls.outputElement)\r\n    ),\r\n    private markdownTagMenuHolder = <HTMLDivElement>(\r\n      document.getElementById(UtilityCls.markdownTagMenuholderID)\r\n    )\r\n  ) {}\r\n  public TextChangeHandler(): void {\r\n    if (this.markdown !== null) {\r\n      this.markdown.onkeyup = (e) => {\r\n        if (this.markdown.value) {\r\n          this.markdownOutput.innerHTML = this.rmkbl.render(\r\n            this.markdown.value\r\n          );\r\n          //this.markdownOutput.innerHTML = this.mkd.parse(this.markdown.value);\r\n          this.histry.history = this.markdown.value;\r\n          this.unreHistory.pushSync(this.histry);\r\n          console.log(\"history lenght: \", this.unreHistory.length);\r\n        } else\r\n          this.markdownOutput.innerHTML = \"<h1>Edit This Heading To Star</h1>\";\r\n      };\r\n    }\r\n  }\r\n  public onloadIOElemInit(): void {\r\n    AddEvtListener.toElem(\"undoContainer\", \"click\", () => {\r\n      this.markdown.value = this.unreHistory.undo().get().history;\r\n      console.log(\"history lenght: \", this.unreHistory.length);\r\n    });\r\n    AddEvtListener.toElem(\"redoContainer\", \"click\", () => {\r\n      this.markdown.value = this.unreHistory.redo().get().history;\r\n      console.log(\"history lenght: \", this.unreHistory.length);\r\n    });\r\n    AddEvtListener.toElem(\"docExporter\", \"click\", () => {\r\n      this.doc.addImage(img, \"png\", 10, 50);\r\n      this.doc.html(this.markdownOutput.innerHTML, {\r\n        callback: function (doc) {\r\n          doc.save();\r\n        },\r\n        autoPaging: \"text\",\r\n        x: 10,\r\n        y: 10,\r\n        width: 180,\r\n        windowWidth: 1000,\r\n        image: { type: \"jpeg\", quality: 0.98 },\r\n        html2canvas: { scale: 2 },\r\n      });\r\n      console.log(\"PDF is being generated \");\r\n    });\r\n\r\n    this.markdownOutput.innerHTML = this.rmkbl.render(this.markdown.value);\r\n  }\r\n\r\n  public onloadMarkdownTagMenuInit(): void {\r\n    const elements = this.markdownTagMenuHolder.children;\r\n\r\n    for (let i = 0; i < elements.length; i++) {\r\n      console.log(elements[i]);\r\n\r\n      elements[i].addEventListener(\"click\", () => {\r\n        this.eInserter.insertAtCursorPosition(\r\n          \"\\r\\n\" + elements[i].getAttribute(\"data-tag-string\")\r\n        );\r\n\r\n        this.markdownOutput.innerHTML = this.rmkbl.render(this.markdown.value);\r\n        //this.markdownOutput.innerHTML = this.mkd.parse(this.markdown.value);\r\n        this.histry.history = this.markdown.value;\r\n        this.unreHistory.pushSync(this.histry);\r\n\r\n        console.log(\"iteration worked\", i);\r\n      });\r\n    }\r\n  }\r\n}\r\n"]}